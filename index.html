<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Brat generator">
  <meta name="keywords" content="Brat generator">
  <link rel="icon" href="images/favicon_96.jpg" type="image/jpeg">
  <title>Brat Generator</title>
  <style>
    @font-face {
      font-family: 'timesregular';

      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'arial_narrowregular';
      src: url('https://www.bratgenerator.com/sites/g/files/g2000017981/files/2024-03/arial_narrow-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #fff;
      margin: 0;
      padding: 0;
    }

    #page, #main-wrapper {
      overflow: hidden;
    }

    #memeContainer {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 80vh;
      cursor: pointer;
    }

    #textInput {
      margin: 14px auto;
      padding: 0;
      font-size: 18px;
      border: 1px solid #d1d1d1;
      border-radius: 16px;
      max-width: 450px;
      width: 90%;
      height: 50px;
      line-height: 50px;
      outline: none;
      font-family: 'timesregular', serif;
      text-align: center;
      z-index: 50;
    }

    #saveButton {
      height: 50px;
      font-size: 16px;
      border: none;
      border-radius: 16px;
      padding: 0 20px;
      margin-left: 10px;
      cursor: pointer;
      background-color: #fff;
      border: 1px solid #d1d1d1;
      color: #000;
      font-family: Arial, sans-serif;
    }

    #saveButton:hover {
      filter: blur(1px);
    }

    #textOverlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2;
      color: #000;
      font-family: 'arial_narrowregular', "Arial Narrow", sans-serif;
      font-size: 150px; /* Larger base font size */
      width: 600px; /* Wider to allow larger text scaling */
      height: 400px; /* Taller to match original proportions */
      text-align: justify;
      text-align-last: justify;
      padding: 20px;
      box-sizing: border-box;
      filter: blur(2px);
      line-height: 1; /* Reduced line spacing */
    }

    body.black #textOverlay {
      text-align: left;
      text-align-last: left;
    }

    body.black #textOverlay .textFitted {
      transform: scaleX(-1);
      text-align: left;
      float: right;
    }

    .themeSelector {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 51;
    }

    .themeSelector > div {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
    }

    #toggleButtonWhite { background-color: #fff; }
    #toggleButtonBlack { background-color: #000; border: 2px solid #000; }

    body.white #toggleButtonWhite, body.black #toggleButtonBlack {
      border: 2px solid #000;
    }

    @media (max-width: 1023px) {
      #textOverlay {
        font-size: 120px;
        width: 400px;
        height: 400px;
      }
      body.white #textOverlay, body.black #textOverlay {
        font-size: 100px;
        width: 400px;
        height: 400px;
        padding: 0;
      }
      #memeContainer { height: 85vh; margin-top: 10%; }
    }
  </style>
</head>
<body class="white">
<div id="page-wrapper">
  <div id="page">
    <div id="main-wrapper">
      <main id="content">
        <div id="memeContainer">
          <div id="textOverlay"></div>
        </div>
        <input type="text" id="textInput" value="brat and itâ€™s completely different but also still brat">
        <button id="saveButton">Save</button>
        <div class="themeSelector">
          <div id="toggleButtonBlack" onclick="setupTheme('black')"></div>
          <div id="toggleButtonWhite" onclick="setupTheme('white')"></div>
        </div>
      </main>
    </div>
  </div>
</div>

<footer>
  Created by Jalpan Vyas
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  (function() {
    var defaultSettings = {
      alignVert: false,
      alignHoriz: false,
      multiLine: true,
      detectMultiLine: true,
      minFontSize: 8,
      maxFontSize: 200, /* Increased to allow larger text */
      reProcess: true,
      widthOnly: false,
      alignVertWithFlexbox: false
    };

    window.textFit = function(els, options) {
      if (!options) options = {};
      var settings = {};
      for (var key in defaultSettings) {
        settings[key] = options.hasOwnProperty(key) ? options[key] : defaultSettings[key];
      }

      if (typeof els.toArray === "function") els = els.toArray();
      var elType = Object.prototype.toString.call(els);
      if (elType !== '[object Array]' && elType !== '[object NodeList]' && elType !== '[object HTMLCollection]') {
        els = [els];
      }

      for (var i = 0; i < els.length; i++) {
        processItem(els[i], settings);
      }
    };

    function processItem(el, settings) {
      if (!isElement(el) || (!settings.reProcess && el.getAttribute('textFitted'))) return false;
      if (!settings.reProcess) el.setAttribute('textFitted', 1);

      var innerSpan, originalHeight, originalHTML, originalWidth;
      originalHTML = el.innerHTML;
      originalWidth = innerWidth(el);
      originalHeight = innerHeight(el);

      if (!originalWidth || (!settings.widthOnly && !originalHeight)) {
        console.warn('textFit: Element must have static width and height. Skipping:', el);
        return false;
      }

      if (originalHTML.indexOf('textFitted') === -1) {
        innerSpan = document.createElement('span');
        innerSpan.className = 'textFitted';
        innerSpan.style.display = 'inline-block';
        innerSpan.innerHTML = originalHTML;
        el.innerHTML = '';
        el.appendChild(innerSpan);
      } else {
        innerSpan = el.querySelector('span.textFitted');
        if (hasClass(innerSpan, 'textFitAlignVert')) {
          innerSpan.className = innerSpan.className.replace('textFitAlignVert', '');
          innerSpan.style.height = '';
          el.className.replace('textFitAlignVertFlex', '');
        }
      }

      if (settings.alignHoriz) {
        el.style.textAlign = innerSpan.style.textAlign = 'center';
      }

      var multiLine = settings.multiLine;
      if (settings.detectMultiLine && !multiLine && innerSpan.getBoundingClientRect().height >= parseInt(window.getComputedStyle(innerSpan)['font-size'], 10) * 2) {
        multiLine = true;
      }

      if (!multiLine) el.style.whiteSpace = 'nowrap';

      var low = settings.minFontSize, high = settings.maxFontSize, size = low;
      while (low <= high) {
        var mid = (high + low) >> 1;
        innerSpan.style.fontSize = mid + 'px';
        var rect = innerSpan.getBoundingClientRect();
        if (rect.width <= originalWidth && (settings.widthOnly || rect.height <= originalHeight)) {
          size = mid;
          low = mid + 1;
        } else {
          high = mid - 1;
        }
      }
      if (innerSpan.style.fontSize != size + 'px') innerSpan.style.fontSize = size + 'px';

      if (settings.alignVert) {
        addStyleSheet();
        var height = innerSpan.scrollHeight;
        if (window.getComputedStyle(el).position === "static") el.style.position = 'relative';
        if (!hasClass(innerSpan, "textFitAlignVert")) innerSpan.className += " textFitAlignVert";
        innerSpan.style.height = height + "px";
        if (settings.alignVertWithFlexbox && !hasClass(el, "textFitAlignVertFlex")) el.className += " textFitAlignVertFlex";
      }
    }

    function innerHeight(el) {
      var style = window.getComputedStyle(el, null);
      return el.getBoundingClientRect().height - parseInt(style.getPropertyValue('padding-top'), 10) - parseInt(style.getPropertyValue('padding-bottom'), 10);
    }

    function innerWidth(el) {
      var style = window.getComputedStyle(el, null);
      return el.getBoundingClientRect().width - parseInt(style.getPropertyValue('padding-left'), 10) - parseInt(style.getPropertyValue('padding-right'), 10);
    }

    function isElement(o) {
      return (typeof HTMLElement === "object" ? o instanceof HTMLElement : o && typeof o === "object" && o !== null && o.nodeType === 1 && typeof o.nodeName === "string");
    }

    function hasClass(element, cls) {
      return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
    }

    function addStyleSheet() {
      if (document.getElementById("textFitStyleSheet")) return;
      var style = [
        ".textFitAlignVert{position: absolute;top: 0; right: 0; bottom: 0; left: 0;margin: auto;display: flex;justify-content: center;flex-direction: column;}",
        ".textFitAlignVertFlex{display: flex;}",
        ".textFitAlignVertFlex .textFitAlignVert{position: static;}"
      ].join("");
      var css = document.createElement("style");
      css.type = "text/css";
      css.id = "textFitStyleSheet";
      css.innerHTML = style;
      document.body.appendChild(css);
    }
  })();

  const textInput = document.getElementById('textInput');
  const textOverlay = document.getElementById('textOverlay');
  const memeContainer = document.getElementById('memeContainer');

  textInput.addEventListener('input', function() {
    textOverlay.innerText = this.value;
    textFit(textOverlay, { maxFontSize: 200 }); /* Match maxFontSize with defaultSettings */
  });

  document.getElementById('saveButton').addEventListener('click', function() {
    html2canvas(memeContainer, {
      backgroundColor: document.body.classList.contains('white') ? '#fff' : '#fff'
    }).then(originalCanvas => {
      const width = originalCanvas.width;
      const height = originalCanvas.height;



      // Create a new canvas to apply blur
      const blurredCanvas = document.createElement('canvas');
      blurredCanvas.width = width;
      blurredCanvas.height = height;
      const ctx = blurredCanvas.getContext('2d');

      // Apply blur filter
      ctx.filter = 'blur(3px)'; // Adjust blur level here
      ctx.drawImage(originalCanvas, 0, 0);

      // Download the blurred image
      const link = document.createElement('a');
      link.download = 'brat_generator_blurred.png';
      link.href = blurredCanvas.toDataURL('image/png');
      link.click();
    }).catch(err => {
      console.error('Error capturing image:', err);
    });

  });

  function setupTheme(color) {
    var body = document.body;
    textInput.value = "";
    if (color === "black") {
      body.classList.remove("white");
      body.classList.add("black");
      textInput.setAttribute("maxlength", "450");
      textInput.value = "brat and itâ€™s completely different but also still brat";
      textOverlay.innerText = textInput.value;
      textFit(textOverlay, { maxFontSize: 180 }); /* Slightly smaller for black theme */
    } else {
      body.classList.remove("black");
      body.classList.add("white");
      textInput.removeAttribute("maxlength");
      textInput.value = "brat and itâ€™s completely different but also still brat";
      textOverlay.innerText = textInput.value;
      textFit(textOverlay, { maxFontSize: 200 });
    }
  }

  // Initialize with the white theme
  setupTheme('white');
</script>
</body>
</html>
